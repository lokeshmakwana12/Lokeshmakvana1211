<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vehicle EMI &amp; Down Payment Calculator </title>
<style>
/* üåü NEON THEME UI üåü */
body {
  font-family: 'Segoe UI', sans-serif;
  background: #02060f;
  margin: 0;
  padding: 0;
  color: #e2e8ff;
}

header {
  background: linear-gradient(90deg,#7f00ff,#e100ff);
  color: white;
  padding: 20px;
  text-align: center;
  font-size: 26px;
  font-weight: bold;
  text-shadow: 0 0 10px #ff4bff, 0 0 20px #9d00ff;
  box-shadow: 0 0 15px rgba(255,0,255,0.4);
}

.container {
  max-width: 1000px;
  margin: 25px auto;
  background: rgba(15, 15, 35, 0.9);
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 0 20px rgba(0,255,255,0.3), 0 0 40px rgba(0,150,255,0.2);
  border: 2px solid rgba(0,255,255,0.4);
}

label {
  font-weight: bold;
  color: #90d7ff;
  text-shadow: 0 0 5px #00eaff;
}

input, select, button {
  margin: 6px 0;
  padding: 12px;
  border-radius: 10px;
  width: 100%;
  box-sizing: border-box;
  font-size: 15px;
}

input, select {
  background: #0a1324;
  border: 1px solid #00eaff;
  color: #dff9ff;
  box-shadow: 0 0 8px rgba(0,255,255,0.3);
}

input:focus, select:focus {
  outline: none;
  border-color: #00f7ff;
  box-shadow: 0 0 12px #00eaff, 0 0 25px #007a99;
}

button {
  background: linear-gradient(90deg,#00eaff,#007bff);
  color: white;
  cursor: pointer;
  border: none;
  font-size: 18px;
  font-weight: bold;
  border-radius: 10px;
  transition: 0.2s;
  text-shadow: 0 0 6px #00cfff;
  box-shadow: 0 0 15px #00cfff, 0 0 30px rgba(0,180,255,0.5);
}

button:hover {
  background: linear-gradient(90deg,#00ffff,#0096ff);
  transform: scale(1.05);
  box-shadow: 0 0 20px #00ffff, 0 0 40px #0099ff;
}

nav {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 25px;
}

nav button {
  width: 170px;
  border-radius: 14px;
}

.table-container {
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 18px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 15px rgba(0,255,255,0.2);
}

th {
  background: linear-gradient(90deg,#007bff,#00d5ff);
  color: white;
  padding: 12px;
  font-size: 16px;
  text-shadow: 0 0 6px #00eaff;
}

td {
  border: 1px solid rgba(0,255,255,0.2);
  padding: 10px;
  text-align: center;
  background: rgba(0,25,50,0.8);
  color: #d4faff;
}

td:hover {
  background: rgba(0,255,255,0.08);
  transition: 0.2s;
}

.result-box {
  background: rgba(0,35,65,0.9);
  padding: 22px;
  border-radius: 14px;
  margin-top: 20px;
  border: 2px solid #00bfff;
  box-shadow: 0 0 15px #00eaff, 0 0 30px rgba(0,255,255,0.3);
  color: #e4f9ff;
}

.hidden { display: none; }
</style>
</head>
<body>
<header>üöó Vehicle EMI &amp; Down Payment Calculator </header>

<nav>
  <button onclick="showPage(1)">Page 1 - Data Entry</button>
  <button onclick="showPage(2)">Page 2 - Calculator</button>
</nav>

<div class="container hidden" id="page1">
  <h2>üìã Add / Manage EMI Records</h2>

  <label>Living Type:</label>
  <select id="livingType">
    <option value="On House">On House</option>
    <option value="Rented">Rented</option>
  </select>

  <label>Date of Birth:</label>
  <input type="date" id="dob" onchange="calculateAge()">
  <label>Age:</label>
  <input type="number" id="age" readonly>

  <label>Vehicle Model:</label>
  <input type="text" id="model" list="modelList">
  <datalist id="modelList"></datalist>

  <label>Down Payment (‚Çπ):</label>
  <input type="number" id="downPayment" placeholder="Enter Down Payment">

  <label>EMI 24 Months (‚Çπ):</label>
  <input type="number" id="emi24" placeholder="Enter EMI for 24 months">
  <label>EMI 36 Months (‚Çπ):</label>
  <input type="number" id="emi36" placeholder="Enter EMI for 36 months">
  <label>EMI 48 Months (‚Çπ):</label>
  <input type="number" id="emi48" placeholder="Enter EMI for 48 months">
  <label>EMI 60 Months (‚Çπ):</label>
  <input type="number" id="emi60" placeholder="Enter EMI for 60 months">

  <button onclick="saveRecord()" id="saveBtn">üíæ Save Record</button>

  <div class="table-container">
    <table id="recordTable">
      <thead>
        <tr>
          <th>Type</th>
          <th>Model</th>
          <th>Age</th>
          <th>Down Payment</th>
          <th>EMI 24</th>
          <th>EMI 36</th>
          <th>EMI 48</th>
          <th>EMI 60</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <label>Upload CSV File:</label>
  <input type="file" id="csvFile" accept=".csv" onchange="uploadCSV()">

  <button onclick="downloadUpdatedHTML()">‚¨áÔ∏è Download Updated HTML</button>
</div>

<div class="container hidden" id="page2">
  <h2>üîç Check EMI by Age &amp; Model</h2>
  <p style="color:#d9534f; font-weight:bold;">‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç: ‡§Ø‡§π EMI ‡§π‡§∞ ‡§Æ‡§π‡•Ä‡§®‡•á ‡§ï‡•Ä 15 ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§∏‡•á 26 ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§°‡§ø‡§∏‡•ç‡§¨‡§∞‡•ç‡§∏ ‡§´‡§æ‡§á‡§≤ ‡§™‡§∞ ‡§≤‡§æ‡§ó‡•Ç ‡§π‡•ã‡§ó‡•Ä‡•§
    ‡§á‡§∏ ‡§Ö‡§µ‡§ß‡§ø ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§Ø‡§æ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç EMI ‡§Æ‡•á‡§Ç ‡§•‡•ã‡§°‡§º‡§æ ‡§Ö‡§Ç‡§§‡§∞ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§<br>
‡§™‡•á‡§∏‡•á‡§®‡•ç‡§ú‡§∞ ‡§ó‡§æ‡•ú‡•Ä ‡§™‡§∞ ‡§™‡§∞‡§Æ‡§ø‡§ü ‡§ï‡§æ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§Ö‡§≤‡§ó ‡§∏‡•á ‡§∞‡§π‡•á‡§ó‡§æ‡•§</p>

  <label>Living Type:</label>
  <select id="checkType">
    <option value="On House">On House</option>
    <option value="Rented">Rented</option>
  </select>

  <label>Date of Birth:</label>
  <input type="date" id="checkDob" onchange="calculateCheckAge()">
  <label>Age:</label>
  <input type="number" id="checkAge" readonly>

  <label>Select Model:</label>
  <select id="checkModel"></select>

  <button onclick="findEMI()">üîé Find EMI</button>

  <div id="resultBox" class="result-box hidden"></div>
<!-- üî• ‡§Ö‡§™‡§®‡§æ ‡§®‡§Ø‡§æ text ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•ã -->
  <p style="margin-top:20px; font-weight:bold; color:#00eaff;">
    * ‡§á‡§∏ ‡§≤‡•ã‡§® ‡§Æ‡•á ‡§ú‡•Ä‡§µ‡§® ‡§¨‡•Ä‡§Æ‡§æ ‡§ì‡§∞ EMI ‡§¨‡•Ä‡§Æ‡§æ ‡§≠‡•Ä ‡§π‡•à‡•§<br>
‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§Ö‡§∏‡•ç‡§™‡§§‡§æ‡§≤ ‡§Æ‡•á ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä ‡§ï‡•Ä ‡§µ‡§ú‡§π ‡§∏‡•á ‡§≠‡§∞‡•ç‡§§‡•Ä ‡§π‡•ã‡§§‡•á ‡§π‡•à ‡§§‡•ã ‡§¨‡•à‡§Ç‡§ï<br>
*2 ‡§¶‡§ø‡§® ‡§∏‡•á 5 ‡§¶‡§ø‡§® ‡§§‡§ï 30000/- ‡§≤‡•ã‡§® ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á ‡§°‡§æ‡§≤‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á <br>
*6 ‡§¶‡§ø‡§® ‡§∏‡•á 8 ‡§¶‡§ø‡§® ‡§§‡§ï 60000/- ‡§≤‡•ã‡§® ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á ‡§°‡§æ‡§≤‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á <br>
*9 ‡§¶‡§ø‡§® ‡§∏‡•á 11 ‡§¶‡§ø‡§® ‡§§‡§ï 90000/- ‡§≤‡•ã‡§® ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á ‡§°‡§æ‡§≤‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á <br>
*12 ‡§¶‡§ø‡§® ‡§∏‡•á 14 ‡§¶‡§ø‡§® ‡§§‡§ï 120000/- ‡§≤‡•ã‡§® ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á ‡§°‡§æ‡§≤‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á <br> 
*15 ‡§¶‡§ø‡§® ‡§∏‡•á 15 ‡§¶‡§ø‡§® ‡§∏‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§¶‡§ø‡§® 150000/- ‡§≤‡•ã‡§® ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á ‡§°‡§æ‡§≤‡•á ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á <br>


  </p>
<p style="color:#d9534f; font-weight:bold;">
    ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç: ‡§Ø‡§π EMI ‡§¨‡•Ä‡§Æ‡§æ 1 ‡§∏‡§æ‡§≤ ‡§Æ‡•á 4 ‡§¨‡§æ‡§∞ ‡§Ø‡§æ 1 ‡§∏‡§æ‡§≤ ‡§Æ‡•á 450000 ‡§≤‡§æ‡§ñ ‡§∏‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á‡§Ç‡§ó‡•á <br>
*‡§¨‡•Ä‡§Æ‡•á ‡§ï‡§æ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü 2 ‡§Æ‡§π‡•Ä‡§®‡•á ‡§Æ‡•á ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ 
  </p>

</div>

<script>
// ---------- CONFIG ----------
const secretPIN = "04101412"; // as provided by user
let accessGranted = false; // will be set true if correct PIN entered

// ---------- DATA ----------
let embeddedRecords = []; // optional: add JSON array to bake data into downloaded file
let records = JSON.parse(localStorage.getItem('emiRecords') || 'null');
if (!records) records = embeddedRecords.slice();
let editIndex = -1;

// ---------- MODELS ----------
let baseModels = ["Bajaj Maxima C Diesel","Bajaj Maxima C CNG","Bajaj Maxima Z","Bajaj RE CNG","Cargo EV"];

// ---------- NAVIGATION: define showPage BEFORE it's used ----------
window.showPage = function(n) {
  // enforce PIN protection
  if (n === 1 && !accessGranted) {
    alert('‚ùå Access Denied! PIN required.');
    return;
  }
  // hide all .container pages
  document.querySelectorAll('.container').forEach(el => el.classList.add('hidden'));
  let target = document.getElementById('page' + n);
  if (target) target.classList.remove('hidden');
};

function populateModels() {
  let dl = document.getElementById('modelList');
  let sel = document.getElementById('checkModel');
  if (!dl || !sel) return;
  dl.innerHTML = '';
  sel.innerHTML = '<option value="">Select Model</option>';
  let set = new Set(baseModels);
  records.forEach(r => { if (r && r.model) set.add(r.model); });
  Array.from(set).forEach(m => {
    let opt = document.createElement('option'); opt.value = m; dl.appendChild(opt);
    let opt2 = document.createElement('option'); opt2.value = m; opt2.textContent = m; sel.appendChild(opt2);
  });
}

function calculateAge() {
  let dob = document.getElementById('dob').value; if(!dob) return;
  let birthDate = new Date(dob); let today = new Date();
  let age = today.getFullYear() - birthDate.getFullYear();
  let m = today.getMonth() - birthDate.getMonth();
  if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
  document.getElementById('age').value = age;
}

function calculateCheckAge() {
  let dob = document.getElementById('checkDob').value; if(!dob) return;
  let birthDate = new Date(dob); let today = new Date();
  let age = today.getFullYear() - birthDate.getFullYear();
  let m = today.getMonth() - birthDate.getMonth();
  if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
  document.getElementById('checkAge').value = age;
}

function clearForm() {
  document.getElementById('dob').value = '';
  document.getElementById('age').value = '';
  document.getElementById('model').value = '';
  document.getElementById('downPayment').value = '';
  document.getElementById('emi24').value = '';
  document.getElementById('emi36').value = '';
  document.getElementById('emi48').value = '';
  document.getElementById('emi60').value = '';
  editIndex = -1;
  let btn = document.getElementById('saveBtn'); if(btn) btn.textContent = 'üíæ Save Record';
}

function saveRecord() {
  let type = document.getElementById('livingType') ? document.getElementById('livingType').value : '';
  let model = document.getElementById('model').value.trim();
  let age = parseInt(document.getElementById('age').value);
  let dp = parseFloat(document.getElementById('downPayment').value) || 0;
  let e24 = parseFloat(document.getElementById('emi24').value) || 0;
  let e36 = parseFloat(document.getElementById('emi36').value) || 0;
  let e48 = parseFloat(document.getElementById('emi48').value) || 0;
  let e60 = parseFloat(document.getElementById('emi60').value) || 0;

  if(!model || !age) { alert('Please enter model and DOB/age first!'); return; }

  if (editIndex !== -1) {
    records[editIndex] = { type, model, age, downPayment: dp, emi24: e24, emi36: e36, emi48: e48, emi60: e60 };
    editIndex = -1;
  } else {
    records = records.filter(r => !(r.type === type && r.model === model && r.age === age));
    records.push({ type, model, age, downPayment: dp, emi24: e24, emi36: e36, emi48: e48, emi60: e60 });
  }

  localStorage.setItem('emiRecords', JSON.stringify(records));
  populateModels(); renderTable(); clearForm(); alert('Record saved successfully!');
}

function renderTable() {
  let tbody = document.querySelector('#recordTable tbody'); if(!tbody) return;
  tbody.innerHTML = '';
  records.forEach((r,i) => {
    let tr = document.createElement('tr');
    tr.innerHTML = "\n      <td>"+ (r.type||'') +"</td>\n      <td>"+ (r.model||'') +"</td>\n      <td>"+ (r.age||'') +"</td>\n      <td>‚Çπ"+ (r.downPayment||0) +"</td>\n      <td>‚Çπ"+ (r.emi24||0) +"</td>\n      <td>‚Çπ"+ (r.emi36||0) +"</td>\n      <td>‚Çπ"+ (r.emi48||0) +"</td>\n      <td>‚Çπ"+ (r.emi60||0) +"</td>\n      <td>\n        <button onclick=\"editRecord("+i+")\">‚úèÔ∏è Edit</button>\n        <button onclick=\"deleteRecord("+i+")\">‚ùå Delete</button>\n      </td>\n    ";
    tbody.appendChild(tr);
  });
}

function deleteRecord(index) {
  if (!confirm('Delete this record?')) return;
  records.splice(index,1);
  localStorage.setItem('emiRecords', JSON.stringify(records));
  populateModels(); renderTable();
}

function editRecord(index) {
  let r = records[index]; if(!r) return;
  if(document.getElementById('livingType')) document.getElementById('livingType').value = r.type;
  document.getElementById('age').value = r.age;
  document.getElementById('model').value = r.model;
  document.getElementById('downPayment').value = r.downPayment || '';
  document.getElementById('emi24').value = r.emi24 || '';
  document.getElementById('emi36').value = r.emi36 || '';
  document.getElementById('emi48').value = r.emi48 || '';
  document.getElementById('emi60').value = r.emi60 || '';
  editIndex = index; let btn = document.getElementById('saveBtn'); if(btn) btn.textContent = 'üîÅ Update Record'; showPage(1);
}

function uploadCSV() {
  let file = document.getElementById('csvFile').files[0];
  if (!file) { alert('Please select CSV file'); return; }
  let reader = new FileReader();
  reader.onload = function(e) {
    let rows = e.target.result.split(/\r?\n/).map(r=>r.trim()).filter(r=>r.length>0);
    let start = 0;
    if (rows.length && rows[0].toLowerCase().includes('type') && rows[0].toLowerCase().includes('model')) start = 1;
    for (let i = start; i < rows.length; i++) {
      let cols = rows[i].split(','); if (cols.length < 8) continue;
      let type = cols[0]?.trim(); let model = cols[1]?.trim(); let age = parseInt(cols[2]);
      let dp = parseFloat(cols[3]) || 0; let e24 = parseFloat(cols[4]) || 0; let e36 = parseFloat(cols[5]) || 0; let e48 = parseFloat(cols[6]) || 0; let e60 = parseFloat(cols[7]) || 0;
      if (!model || !age) continue;
      records = records.filter(r => !(r.type === type && r.model === model && r.age === age));
      records.push({ type, model, age, downPayment: dp, emi24: e24, emi36: e36, emi48: e48, emi60: e60 });
    }
    localStorage.setItem('emiRecords', JSON.stringify(records)); populateModels(); renderTable(); alert('CSV Upload Successfully!');
  };
  reader.readAsText(file);
}

function findEMI() {
  let type = document.getElementById('checkType') ? document.getElementById('checkType').value : '';
  let model = document.getElementById('checkModel').value;
  let age = parseInt(document.getElementById('checkAge').value);
  if(!model || !age) { alert('Enter DOB and select model'); return; }
  let found = records.find(r => r.model === model && r.age === age && r.type === type);
  let box = document.getElementById('resultBox');
  if(found) {
    box.innerHTML = "<h3>üí° "+type+" EMI Details for "+model+" (Age "+age+")</h3>"+
                    "<p><b>Down Payment:</b> ‚Çπ"+(found.downPayment||0)+"</p>"+
                    "<p><b>EMI 24 Months:</b> ‚Çπ"+(found.emi24||0)+"</p>"+
                    "<p><b>EMI 36 Months:</b> ‚Çπ"+(found.emi36||0)+"</p>"+
                    "<p><b>EMI 48 Months:</b> ‚Çπ"+(found.emi48||0)+"</p>"+
                    "<p><b>EMI 60 Months:</b> ‚Çπ"+(found.emi60||0)+"</p>";
  } else {
    box.innerHTML = '<p>‚ùå No data found for '+type+', this age, and model.</p>';
  }
  box.classList.remove('hidden');
}

function downloadUpdatedHTML() {
  let html = document.documentElement.outerHTML;
  // embed current records safely without using regex replacement
  let recIndex = html.indexOf('let records =');
  if (recIndex !== -1) {
    let sem = html.indexOf(';', recIndex);
    if (sem !== -1) {
      html = html.slice(0, recIndex) + 'let records = ' + JSON.stringify(records, null, 2) + ';' + html.slice(sem+1);
    }
  }
  // PIN kept ‚Äî no removal
  // (block removed)
  let blob = new Blob([html], {type: 'text/html'});
  let a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = 'Vehicle_EMI_Final_Updated.html'; a.click();
}

// on load: ALWAYS ask PIN (Strong Security)
window.addEventListener('load', function() {
  accessGranted = false;
  document.getElementById('page1').classList.add('hidden');
  var pin = prompt('Enter Access PIN to open Page 1:');
  if (pin === secretPIN) {
    accessGranted = true;
    window.showPage(1);
  } else {
    accessGranted = false;
    window.showPage(2);
  }
});

// initialize UI
populateModels(); renderTable();
</script>
</body>
</html>
